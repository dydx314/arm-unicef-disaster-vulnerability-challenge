from modal import App
from modal_store import zindi_image, zindi_volumes, REMOTE_DIR
from utils import print_files_in_path

app = App()


@app.function(image=zindi_image, volumes=zindi_volumes, gpu="any")
def load_test_csv():
    import pandas as pd
    import numpy as np

    df = pd.read_csv(f"{REMOTE_DIR}/data/Test.csv")
    return df

@app.function(image=zindi_image, volumes=zindi_volumes, gpu="any")
def load_test_img():
    from PIL import Image

    img = Image.open(f"{REMOTE_DIR}/data/Images/id_h06e87g97s17.tif")
    return img

@app.function(image=zindi_image, volumes=zindi_volumes, gpu="any")
def print_files():
    print_files_in_path("/usr/local/")

@app.function(image=zindi_image, volumes=zindi_volumes, gpu="any")
def print_package():
    import subprocess
    result = subprocess.run(["which", "nvcc"], capture_output=True, text=True)
    return result.stdout

@app.local_entrypoint()
def main():
    print(load_test_img.remote())

    #print("the test file is", load_test_csv.remote())
    #print(print_files.remote())
