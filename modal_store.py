from modal import Image, Volume

REMOTE_DIR = "/code"

volume = Volume.from_name("zindi", create_if_missing=True)
zindi_volumes = {REMOTE_DIR: volume}

zindi_image = (
    Image.from_registry("nvidia/cuda:12.1.1-devel-ubuntu22.04", add_python="3.10")
    .pip_install_from_requirements("requirements.txt")
    .apt_install("libgl1", "libglib2.0-0")
    # .apt_install("git")
    # .apt_install("pip")
    # .apt_install("python3-pip")
    # .env({"CUDA_HOME": "/usr/local/cuda"})
    # .run_commands([
    #     "cd /root && git init .",
    #     "cd /root && git clone https://github.com/IDEA-Research/GroundingDINO.git",
    #     "cd /root/GroundingDINO && pip install torch && pip install -e . --extra-index-url https://download.pytorch.org/whl/cu121",
    #     "cd /root/GroundingDINO && mkdir weights && cd weights && wget -q https://github.com/IDEA-Research/GroundingDINO/releases/download/v0.1.0-alpha/groundingdino_swint_ogc.pth",
    # ])
)


def batch_upload_to_modal():
    print("Uploading to volume...")
    with volume.batch_upload(force=True) as batch:
        batch.put_directory("../../Downloads/Images", "data/Images")
    print("Upload complete.")


# run when needed
#batch_upload_to_modal()
# print(volume.listdir("/"))
# volume.remove_file("zindi", recursive=True)
