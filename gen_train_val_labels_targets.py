import pandas as pd
import numpy as np

from utils import split_train_val, gen_target_df


def main():
    df = pd.read_csv("data/final/Train.csv")
    train_df, val_df, small_df = split_train_val(df, gen_small=True)
    train_df.to_csv("data/train.csv", index=False)
    val_df.to_csv("data/val.csv", index=False)
    small_df.to_csv("data/val_30.csv", index=False)

    train_target = gen_target_df(train_df)
    train_target.to_csv("data/train_target.csv", index=False)
    val_target = gen_target_df(val_df)
    val_target.to_csv("data/val_target.csv", index=False)
    val_30_target = gen_target_df(small_df)
    val_30_target.to_csv("data/val_30_target.csv", index=False)

    # group_indices = np.arange(0, len(val_target), 3)
    # np.random.seed(3)
    # sampled_group_start_indices = np.random.choice(group_indices, 30, replace=False)
    # val_30_target = pd.concat([val_target.iloc[i:i + 3] for i in sampled_group_start_indices])
    # val_30_target.to_csv("data/val_30_target.csv", index=False)
    # val_30_target

    # unique_imgs = val_30_target['image_id'].str.rsplit('_', n=1).str[0].unique()
    # val_30_df = val_df[val_df["image_id"].isin(unique_imgs)]
    # val_30_df.to_csv("data/val_30.csv", index=False)


if __name__ == "__main__":
    main()
